name: Build 3DS Homebrew

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    container:
      image: devkitpro/devkitarm  # <-- use devkitPro Docker image

    steps:
    - name: Checkout
      uses: actions/checkout@v4
      

    # Install devkitARM & 3DS libraries


      # Compile using build3ds.hxml
    - name: Compile for 3DS
      run: |
          haxe build3ds.hxml

    - name: Build CIA package
      run: |
          # Example assumes your .3dsx is at build/cpp/bin/app.3dsx
          # Convert .3dsx -> .cia using bannertool + makerom
          bannertool makebanner -i icon.png -a audio.wav -o banner.bnr
          bannertool makesmdh -s "Psych Engine" -l "Psych Engine (3DS)" -p "Psych" -i icon.png -o icon.icn
          makerom -f cia -o PsychEngine.cia -elf build/cpp/bin/app.elf \
            -icon icon.icn -banner banner.bnr \
            -rsf build/cia/cia.rsf \
            -exefslogo

    - name: Upload 3DS Build
      uses: actions/upload-artifact@main
      with:
          name: cia Build
          path: build/cpp/bin/*.cia
