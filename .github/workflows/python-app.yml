name: Build 3DS Homebrew

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    # Install devkitARM & 3DS libraries
    - name: Install devkitPro
      run: |
        sudo mkdir -p /etc/pacman.d
        sudo tee /etc/pacman.d/mirrorlist <<EOF
        Server = https://downloads.devkitpro.org/packages
        EOF
        sudo tee /etc/pacman.conf <<EOF
        [dkp-libs]
        Server = https://downloads.devkitpro.org/packages
        SigLevel = Never
        [dkp]
        Server = https://downloads.devkitpro.org/packages
        SigLevel = Never
        EOF
        sudo pacman -Sy --noconfirm
        sudo pacman -S --noconfirm devkitARM 3ds-dev

    # Build the project (example LovePotion build)
    - name: Build 3dsx
      run: |
        export DEVKITPRO=/opt/devkitpro
        export DEVKITARM=/opt/devkitpro/devkitARM
        make
